# Project Status

- Last Updated: 2026-02-12 (react-selector-stability-fix)

- Current progress:
  - Worktree manager system remains in place across backend/store/UI with enriched worktree metadata and safe lifecycle actions.
  - Added local automation bridge in `apps/desktop/src-tauri/src/lib.rs`:
    - HTTP listener on `127.0.0.1:47631`,
    - endpoints `GET /v1/health`, `GET /v1/workspaces`, `POST /v1/commands`, `GET /v1/jobs/:jobId`,
    - queued async job processing for:
      - `create_panes`,
      - `create_worktree`,
      - `create_branch`,
      - `run_command`.
  - Added frontend handshake for UI-owned automation actions in `apps/desktop/src/App.tsx`:
    - listens to `automation:request`,
    - applies `create_panes` / `import_worktree`,
    - reports completion/failure with `automation_report`.
  - Added workspace runtime snapshot sync from Zustand to backend in `apps/desktop/src/store/workspace.ts`:
    - `syncAutomationWorkspaces` called during bootstrap/workspace lifecycle/pane lifecycle changes.
  - Patched backend reliability path so pending frontend acks are cleaned up on emit failure and timeout.
  - Added global Codex skill at `~/.codex/skills/supervibing-automation`:
    - `SKILL.md` with usage workflow and troubleshooting,
    - `scripts/supervibing_automation.py` wrapper CLI for health/workspaces/job and bridge command actions,
    - `agents/openai.yaml` for UI metadata.
  - Wrapper defaults are aligned with product decisions:
    - submit-and-wait by default,
    - optional `--no-wait`,
    - health-check-only app lifecycle (no auto-start).
  - Extended inactive workspace lifetime in `apps/desktop/src/store/workspace.ts`:
    - `INACTIVE_WORKSPACE_SUSPEND_MS` increased from `120s` to `10m` to keep workspaces alive longer before auto-suspend.
  - Fixed workspace-switch terminal clearing in frontend:
    - `apps/desktop/src/App.tsx` now keeps all workspace `PaneGrid` instances mounted in Terminal section,
    - inactive workspace grids are hidden (not unmounted), preserving xterm buffer state,
    - `apps/desktop/src/styles.css` adds stacked grid panel visibility classes.
  - Fixed terminal copy + initial glyph spacing issues in frontend:
    - `apps/desktop/src/components/TerminalPane.tsx` now handles `Ctrl+Shift+C` via xterm custom key handler and copies current selection to clipboard,
    - empty-selection copy chord is consumed as no-op (no terminal input),
    - startup now performs staged refit/resize (open, next frame, fonts-ready) and refits again when a hidden workspace pane becomes active,
    - `apps/desktop/src/App.tsx` + `apps/desktop/src/components/PaneGrid.tsx` pass active visibility state to `TerminalPane`.
  - Added tmux-style core shortcut profile in frontend:
    - `apps/desktop/src/App.tsx` now uses a `Ctrl+B` prefix controller with a `1000ms` timeout and tmux-like pane mappings (`%`, `"`, `c`, `n`, `p`, `o`, `0..9`, arrows, `z`, `x`, `&`, `Alt+Arrow`),
    - legacy non-tmux pane hotkeys were removed from the global app shortcut handler; global app keys (`Ctrl/Cmd+N`, `Ctrl/Cmd+P`, `Escape`) remain,
    - Settings shortcut list now reflects tmux core bindings.
  - Added keyboard resize support for focused panes in freeform mode:
    - `apps/desktop/src/store/workspace.ts` includes `resizeFocusedPaneByDelta(workspaceId, dx, dy)` used by tmux `prefix+Alt+Arrow`,
    - resize is no-op outside freeform mode.
  - Added startup crash recovery and renderer failure guardrails:
    - frontend root is wrapped by `StartupErrorBoundary` in `apps/desktop/src/main.tsx`,
    - startup/runtime global listeners now log `[startup]` `error` and `unhandledrejection` events,
    - new recovery UI `apps/desktop/src/components/StartupCrashScreen.tsx` provides `Retry`, `Reset local data`, and detail toggle.
  - Hardened bootstrap failure handling in `apps/desktop/src/store/workspace.ts`:
    - added `startupError` state and fail-safe bootstrap `try/catch`,
    - added `clearStartupError` and `resetLocalStateAndRebootstrap`,
    - added persistence reset API `resetPersistedPayload` in `apps/desktop/src/lib/persistence.ts`.
  - Added regression coverage for startup recovery:
    - `apps/desktop/src/components/StartupErrorBoundary.test.tsx`,
    - `apps/desktop/src/lib/persistence.test.ts`,
    - extended `apps/desktop/src/store/workspace.test.ts` with bootstrap failure and reset+rebootstrap scenarios.
  - Fixed React external-store rerender loop risk in frontend selector wiring:
    - `apps/desktop/src/App.tsx` now separates worktree manager core selector from derived open-workspace paths selector,
    - removed nested inline `.map()` output from a `useShallow` object selector to keep snapshot comparisons stable under React 19,
    - added selector stability regressions in `apps/desktop/src/App.selectors.test.ts`.

- Verification:
  - `cargo test -q` (in `apps/desktop/src-tauri`) ✅
    - Rust tests passed (10/10).
  - `cargo check -q` (in `apps/desktop/src-tauri`) ✅
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/store/workspace.test.ts src/components/CommandPalette.test.tsx src/components/AppSidebar.test.tsx tests/styles.soft-ui.test.ts` ✅
    - desktop tests passed (63/63 in run scope).
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py --help` ✅
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py create-worktree --help` ✅
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py --json health` executed and returned `connection refused` (expected while app bridge is not running) ✅
  - `pnpm --filter @supervibing/desktop test -- run src/store/workspace.test.ts` ✅
    - workspace/store and related desktop tests passed (63/63 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/components/PaneGrid.test.tsx src/components/AppSidebar.test.tsx src/components/CommandPalette.test.tsx` ✅
    - desktop tests passed (63/63 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/components/PaneGrid.test.tsx src/components/TerminalPane.test.tsx` ✅
    - desktop tests passed (68/68 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/store/workspace.test.ts` ✅
    - desktop tests passed (77/77 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/store/workspace.test.ts src/components/StartupErrorBoundary.test.tsx src/lib/persistence.test.ts` ✅
    - desktop tests passed (82/82 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.selectors.test.ts src/App.shortcuts.test.ts src/store/workspace.test.ts` ✅
    - desktop tests passed (85/85 in run scope).
  - `timeout 35s pnpm tauri:dev` ✅
    - Vite + Tauri dev app launched cleanly without immediate startup panic in terminal output.

- Blockers/Bugs:
  - No functional blockers identified.
  - User-reported React stack flood (`forceStoreRerender/updateStoreInstance`) is addressed in selector wiring; browser-console confirmation in the reporter environment is still pending.
  - Packaged-app Linux compositor compatibility still depends on host WebKit/GPU stack; diagnostics documented in `docs/architecture.md`.
  - Automation bridge currently relies on localhost binding without auth; acceptable for local-only automation, but token-based guard may be needed for stricter host-hardening.
  - Non-fatal shell startup warnings (`fnm/starship` permission and nvm prefix warnings) continue in command output and do not affect build/test outcomes.
  - Live skill smoke tests for `workspaces`/job execution are blocked until SuperVibing desktop is running and serving the automation port.

- Next immediate starting point:
  - Reproduce the previously failing startup path in the reporter environment and confirm browser console no longer shows the `getRootForUpdatedFiber` / `forceStoreRerender` stack.
  - Manually verify startup recovery UX in packaged and dev launch paths:
    - force bootstrap failure and confirm crash screen with Retry/Reset actions,
    - confirm Reset recovers to default workspace after clearing local store.
  - Run Linux compositor diagnostics for black-screen reports:
    - `pnpm tauri:debug`,
    - `WEBKIT_DISABLE_DMABUF_RENDERER=1 pnpm tauri:debug`,
    - `WEBKIT_DISABLE_COMPOSITING_MODE=1 pnpm tauri:debug`.
  - Re-run manual tmux/terminal/workspace checks after startup recovery patch to confirm no regressions.
  - Launch SuperVibing desktop and run full automation skill smoke tests once app is active.
