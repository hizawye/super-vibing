# Project Status

- Last Updated: 2026-02-13 (tmux-prefix-workspace-cycle)

- Current progress:
  - Added tmux-style workspace cycling in frontend shortcuts:
    - `apps/desktop/src/App.tsx` now maps `Ctrl+B` prefix + `)`/`(` to next/previous workspace activation with wrap-around order.
    - tmux shortcut context now includes workspace order + active workspace setter for prefix-driven workspace switching.
    - Settings shortcut list now documents `Prefix + ) / (` for workspace navigation.
  - Added regression coverage for workspace prefix navigation:
    - `apps/desktop/src/App.shortcuts.test.ts` now verifies next/previous workspace switching, boundary wrap-around, and one-workspace no-op behavior.
  - Hardened release/version pipeline guardrails:
    - `scripts/verify-release-version.sh` now validates parity across root/desktop/tauri manifests plus release tag,
    - failure output now reports all detected versions and a direct remediation command.
  - Added automated release-prep helper:
    - new `scripts/prepare-release-version.sh`,
    - root pnpm commands `release:prepare` and `release:verify` for local/CI parity consistency.
  - Added guarded release-tag helper:
    - new `scripts/create-release-tag.sh`,
    - root pnpm command `release:tag` blocks tag creation unless the repo is clean and parity-ready.
  - Updated release workflow parity step in `.github/workflows/release.yml` to invoke `pnpm run release:verify -- <tag>`.
  - Applied release recovery metadata alignment:
    - `package.json`, `apps/desktop/package.json`, and `apps/desktop/src-tauri/tauri.conf.json` are now set to version `0.1.13`.
    - release tag `v0.1.13` was published and GitHub `Release` workflow run `21970252972` completed successfully.
  - Worktree manager system remains in place across backend/store/UI with enriched worktree metadata and safe lifecycle actions.
  - Added local automation bridge in `apps/desktop/src-tauri/src/lib.rs`:
    - HTTP listener uses preferred bind from `SUPERVIBING_AUTOMATION_BIND` (default `127.0.0.1:47631`) with fallback scan `127.0.0.1:47631..47641`,
    - endpoints `GET /v1/health`, `GET /v1/workspaces`, `POST /v1/commands`, `GET /v1/jobs/:jobId`,
    - queued async job processing for:
      - `create_panes`,
      - `create_worktree`,
      - `create_branch`,
      - `run_command`.
  - Added frontend handshake for UI-owned automation actions in `apps/desktop/src/App.tsx`:
    - listens to `automation:request`,
    - applies `create_panes` / `import_worktree`,
    - reports completion/failure with `automation_report`.
  - Added workspace runtime snapshot sync from Zustand to backend in `apps/desktop/src/store/workspace.ts`:
    - `syncAutomationWorkspaces` called during bootstrap/workspace lifecycle/pane lifecycle changes.
  - Patched backend reliability path so pending frontend acks are cleaned up on emit failure and timeout.
  - Added global Codex skill at `~/.codex/skills/supervibing-automation`:
    - `SKILL.md` with usage workflow and troubleshooting,
    - `scripts/supervibing_automation.py` wrapper CLI for health/workspaces/job and bridge command actions,
    - `agents/openai.yaml` for UI metadata,
    - wrapper now auto-discovers fallback bridge port range when implicit default URL is used.
  - Wrapper defaults are aligned with product decisions:
    - submit-and-wait by default,
    - optional `--no-wait`,
    - health-check-only app lifecycle (no auto-start).
  - Extended inactive workspace lifetime in `apps/desktop/src/store/workspace.ts`:
    - `INACTIVE_WORKSPACE_SUSPEND_MS` increased from `120s` to `10m` to keep workspaces alive longer before auto-suspend.
  - Fixed workspace-switch terminal clearing in frontend:
    - `apps/desktop/src/App.tsx` now keeps all workspace `PaneGrid` instances mounted in Terminal section,
    - inactive workspace grids are hidden (not unmounted), preserving xterm buffer state,
    - `apps/desktop/src/styles.css` adds stacked grid panel visibility classes.
  - Fixed terminal history clearing when leaving Terminal section (e.g., Settings) and coming back:
    - `apps/desktop/src/App.tsx` now keeps terminal surface mounted whenever workspaces exist and toggles visibility via `hidden/aria-hidden`,
    - `PaneGrid` `isActive` now depends on both active section and active workspace (`isTerminalSection && workspace.id === activeWorkspaceId`) so refit/resize behavior remains correct on return,
    - added regression coverage in `apps/desktop/src/App.terminal-persistence.test.tsx` to prevent unmount regressions across `Terminal -> Settings -> Terminal`.
  - Fixed terminal copy + initial glyph spacing issues in frontend:
    - `apps/desktop/src/components/TerminalPane.tsx` now handles `Ctrl+Shift+C` via xterm custom key handler and copies current selection to clipboard,
    - empty-selection copy chord is consumed as no-op (no terminal input),
    - startup now performs staged refit/resize (open, next frame, fonts-ready) and refits again when a hidden workspace pane becomes active,
    - `apps/desktop/src/App.tsx` + `apps/desktop/src/components/PaneGrid.tsx` pass active visibility state to `TerminalPane`.
  - Added tmux-style core shortcut profile in frontend:
    - `apps/desktop/src/App.tsx` now uses a `Ctrl+B` prefix controller with a `1000ms` timeout and tmux-like pane mappings (`%`, `"`, `c`, `n`, `p`, `o`, `0..9`, arrows, `z`, `x`, `&`, `Alt+Arrow`),
    - app prefix handling remains active inside terminal pane input scope, so `Ctrl+B` is consumed by the app when tmux shortcut context is eligible,
    - legacy non-tmux pane hotkeys were removed from the global app shortcut handler; global app keys (`Ctrl/Cmd+N`, `Ctrl/Cmd+P`, `Escape`) remain,
    - Settings shortcut list now reflects tmux core bindings.
  - Added keyboard resize support for focused panes in freeform mode:
    - `apps/desktop/src/store/workspace.ts` includes `resizeFocusedPaneByDelta(workspaceId, dx, dy)` used by tmux `prefix+Alt+Arrow`,
    - resize is no-op outside freeform mode.
  - Added startup crash recovery and renderer failure guardrails:
    - frontend root is wrapped by `StartupErrorBoundary` in `apps/desktop/src/main.tsx`,
    - startup/runtime global listeners now log `[startup]` `error` and `unhandledrejection` events,
    - new recovery UI `apps/desktop/src/components/StartupCrashScreen.tsx` provides `Retry`, `Reset local data`, and detail toggle.
  - Hardened bootstrap failure handling in `apps/desktop/src/store/workspace.ts`:
    - added `startupError` state and fail-safe bootstrap `try/catch`,
    - added `clearStartupError` and `resetLocalStateAndRebootstrap`,
    - added persistence reset API `resetPersistedPayload` in `apps/desktop/src/lib/persistence.ts`.
  - Added regression coverage for startup recovery:
    - `apps/desktop/src/components/StartupErrorBoundary.test.tsx`,
    - `apps/desktop/src/lib/persistence.test.ts`,
    - extended `apps/desktop/src/store/workspace.test.ts` with bootstrap failure and reset+rebootstrap scenarios.
  - Fixed React external-store rerender loop risk in frontend selector wiring:
    - `apps/desktop/src/App.tsx` now separates worktree manager core selector from derived open-workspace paths selector,
    - removed nested inline `.map()` output from a `useShallow` object selector to keep snapshot comparisons stable under React 19,
    - added selector stability regressions in `apps/desktop/src/App.selectors.test.ts`.
  - Added global agent startup defaults in frontend settings/store:
    - `apps/desktop/src/store/workspace.ts` now persists `agentStartupDefaults` in session state and applies them to newly created/imported workspaces,
    - `apps/desktop/src/App.tsx` Settings now provides editable per-agent startup commands and a reset action,
    - `apps/desktop/src/components/NewWorkspaceModal.tsx` now seeds agent command defaults from global settings.
  - Fixed keyboard shortcuts while terminal pane has focus:
    - `apps/desktop/src/components/TerminalPane.tsx` marks terminal shortcut scope with `data-terminal-pane`,
    - `apps/desktop/src/App.tsx` no longer treats xterm input focus as a generic editable-target block for app/tmux shortcut handling,
    - window keydown listener now uses capture phase so app-prefixed pane shortcuts remain reliable around terminal event propagation.
  - Hardened worktree lifecycle UX coverage:
    - `apps/desktop/src/store/workspace.test.ts` now covers managed worktree create-without-open and remove-with-open-workspace cleanup paths.
  - Hardened Rust automation bridge request surface in `apps/desktop/src-tauri/src/lib.rs`:
    - optional bearer-token auth via `SUPERVIBING_AUTOMATION_TOKEN`,
    - request validation before queueing (`workspaceId`, `paneCount`, branch/command checks),
    - queue-full returns `429` and expanded HTTP status mapping,
    - completed-job retention cap to bound in-memory automation job growth,
    - health response bind field now reflects runtime-selected bridge bind address.

- Verification:
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts` ✅
    - desktop tests passed (97/97 in run scope).
  - `pnpm run release:verify -- v0.1.11` ✅
  - `pnpm run release:tag -- 0.1.13` ✅ expected fail on dirty tree (guard behavior verified).
  - `pnpm run release:prepare -- 0.1.13` ✅
  - `pnpm run release:tag -- 0.1.13` ✅ created local annotated tag `v0.1.13` on release commit.
  - `git push origin refs/heads/main` ✅
  - `git push origin refs/tags/v0.1.13` ✅
  - `gh run view 21970252972 --json status,conclusion,url` ✅
    - status `completed`, conclusion `success`, URL `https://github.com/hizawye/super-vibing/actions/runs/21970252972`.
  - `pnpm run release:verify -- v0.1.10` ✅ (before version bump, parity passed at `0.1.10`)
  - `pnpm run release:verify -- v0.1.11` ✅ expected fail before bump (mismatch surfaced with remediation hint)
  - `pnpm run release:prepare -- 0.1.11` ✅
  - `pnpm run release:verify -- v0.1.11` ✅ (after version bump)
  - `cargo test -q` (in `apps/desktop/src-tauri`) ✅
    - Rust tests passed (10/10).
  - `cargo check -q` (in `apps/desktop/src-tauri`) ✅
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/store/workspace.test.ts src/components/CommandPalette.test.tsx src/components/AppSidebar.test.tsx tests/styles.soft-ui.test.ts` ✅
    - desktop tests passed (63/63 in run scope).
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py --help` ✅
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py create-worktree --help` ✅
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py --json health` executed and returned `connection refused` (expected while app bridge is not running) ✅
  - `pnpm --filter @supervibing/desktop test -- run src/store/workspace.test.ts` ✅
    - workspace/store and related desktop tests passed (63/63 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/components/PaneGrid.test.tsx src/components/AppSidebar.test.tsx src/components/CommandPalette.test.tsx` ✅
    - desktop tests passed (63/63 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/components/PaneGrid.test.tsx src/components/TerminalPane.test.tsx` ✅
    - desktop tests passed (68/68 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/store/workspace.test.ts` ✅
    - desktop tests passed (77/77 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/store/workspace.test.ts src/components/StartupErrorBoundary.test.tsx src/lib/persistence.test.ts` ✅
    - desktop tests passed (82/82 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.selectors.test.ts src/App.shortcuts.test.ts src/store/workspace.test.ts` ✅
    - desktop tests passed (85/85 in run scope).
  - `timeout 35s pnpm tauri:dev` ✅
    - Vite + Tauri dev app launched cleanly without immediate startup panic in terminal output.
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/App.settings-updater.test.tsx src/store/workspace.test.ts src/components/TerminalPane.test.tsx` ✅
    - desktop tests passed (92/92).
  - `cargo test -q` (in `apps/desktop/src-tauri`) ✅
    - Rust tests passed (16/16).
  - `cargo check -q` (in `apps/desktop/src-tauri`) ✅
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts src/components/TerminalPane.test.tsx` ✅
    - desktop tests passed (93/93 in run scope).
  - `pnpm --filter @supervibing/desktop typecheck` ✅
  - `cargo test -q` (in `apps/desktop/src-tauri`) ✅
    - Rust tests passed (20/20).
  - `cargo check -q` (in `apps/desktop/src-tauri`) ✅
  - `timeout 55s pnpm tauri:dev` ✅
    - with `127.0.0.1:47631` occupied, backend logged fallback bind success on `127.0.0.1:47632`.
  - `python3 ~/.codex/skills/supervibing-automation/scripts/supervibing_automation.py --json health` ✅
    - wrapper output now includes `baseUrl` alongside health payload.
  - `pnpm --filter @supervibing/desktop test -- run src/App.shortcuts.test.ts` ✅
    - desktop tests passed (94/94 in run scope).

- Blockers/Bugs:
  - Historical note: failed tag `v0.1.12` remains in history (manifest mismatch); immutable recovery was shipped as successful `v0.1.13`.
  - No functional blockers identified.
  - User-reported React stack flood (`forceStoreRerender/updateStoreInstance`) is addressed in selector wiring; browser-console confirmation in the reporter environment is still pending.
  - Packaged-app Linux compositor compatibility still depends on host WebKit/GPU stack; diagnostics documented in `docs/architecture.md`.
  - Automation bearer-token auth is optional and env-driven; hosts that need stricter local protection should set `SUPERVIBING_AUTOMATION_TOKEN`.
  - Non-fatal shell startup warnings (`fnm/starship` permission and nvm prefix warnings) continue in command output and do not affect build/test outcomes.
  - Live skill smoke tests for `workspaces`/job execution remain blocked until SuperVibing desktop is running and serving the automation port.
  - By design, app tmux shortcut handling now captures `Ctrl+B` in eligible terminal scope; shell tmux users may need a non-default prefix or app shortcut changes.

- Next immediate starting point:
  - Use guarded release checklist for future versions:
    - `pnpm run release:prepare -- X.Y.Z`,
    - commit version parity changes,
    - `pnpm run release:tag -- X.Y.Z`,
    - push `refs/heads/main` and `refs/tags/vX.Y.Z`,
    - monitor `Release` workflow completion.
  - Manual UX pass:
    - verify settings-edited startup commands are applied for new workspaces and imports,
    - verify app pane prefix `Ctrl+B` works while cursor is inside active xterm pane and while terminal panes are not focused.
  - Automation fallback validation pass:
    - launch app with `SUPERVIBING_AUTOMATION_BIND=127.0.0.1:47631` while `47631` is occupied and verify fallback range bind selection,
    - verify CLI auto-discovery by running wrapper without `--base-url` or `SUPERVIBING_AUTOMATION_URL`.
  - Automation smoke run with auth enabled:
    - launch app with `SUPERVIBING_AUTOMATION_TOKEN=<token>`,
    - validate `401` on missing token and success with valid `Bearer` token.
  - Keep Linux compositor diagnostics in the loop for black-screen reports:
    - `pnpm tauri:debug`,
    - `WEBKIT_DISABLE_DMABUF_RENDERER=1 pnpm tauri:debug`,
    - `WEBKIT_DISABLE_COMPOSITING_MODE=1 pnpm tauri:debug`.
